<link rel="import" href="../../../components/polymer/polymer.html">
<link rel="import" href="../../../components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../../../components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../../components/core-animated-pages/transitions/cross-fade.html">
<link rel="import" href="../../../components/core-ajax/core-ajax.html">
<link rel="import" href="../../../components/paper-toast/paper-toast.html">
<link rel="import" href="../yo-navpanel/yo-navpanel.html">
<link rel="import" href="../yo-grouppanel/yo-grouppanel.html">
<link rel="import" href="../yo-grouplist/yo-grouplist.html">
<link rel="import" href="../yo-messagelist/yo-messagelist.html">

<polymer-element name="yo-app">
	<template>
		<link rel="stylesheet" href="yo-app.css">

		<div horizontal layout center fit cross-fade class="loadingBacktround" hidden?="{{!loading}}">
			<div class="spinner">
			  <div class="dot1"></div>
			  <div class="dot2"></div>
			</div>
		</div>

		<core-drawer-panel cross-fade hidden?="{{loading}}">

			<core-animated-pages drawer selected="{{curPage}}" transitions="cross-fade-all" flex>
				<yo-navpanel user="{{user}}" on-select-group="{{onSelectGroup}}"></yo-navpanel>
				<yo-grouppanel group="{{selectedGroup}}"></yo-grouppanel>
			</core-animated-pages>

		    <core-animated-pages main id="pages" selected="{{curPage}}" transitions="cross-fade-all hero-transition" flex>

				<yo-grouplist groups="{{user.groups}}" userId="{{user.id}}" on-select-group="{{onSelectGroup}}" on-user-error="{{handleError}}"></yo-grouplist>

				<yo-messagelist group="{{selectedGroup}}" userId="{{user.id}}" on-back="{{onback}}" on-user-error="{{handleError}}"></yo-messagelist>

		    </core-animated-pages>

		</core-drawer-panel>

		<core-ajax id="httpHelper" url="{{request.url}}" method="{{request.method}}" handleAs="json"
				params="{{request.params}}" on-core-response="{{handleResponse}}" on-core-error="{{handleError}}"></core-ajax>
		<paper-toast id="toast" class="capsule" text="{{toastMessage}}" style="padding-right: 60px;"></paper-toast>
	</template>
	<script>
	(function () {
		Polymer({
			ready: function () {
				this.loading = true;
				this.curPage = 0;

				this.request = {
					url: '/note/api/user',
					method: 'GET',
					params: {
						extid: 'TEST'
					}
				};
				this.$.httpHelper.go();
			},
			onSelectGroup: function (event, detail, sender) {
				this.selectedGroup = detail;
				this.curPage = 1;
			},
			onback: function (event, detail, sender) {
				this.curPage = 0;
			},
			handleResponse: function (event, detail, sender) {
				if (detail.response.success) {
					this.loading = false;
					this.user = detail.response.data;
				} else {
					this.toastMessage = detail.response.data;
					this.$.toast.show();
				}
			},
			handleError: function (event, detail, sender) {
				this.toastMessage = detail.toString();
				this.$.toast.show();
			}
		});
	})();
	</script>
</polymer-element>












